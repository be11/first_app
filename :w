require 'getweather2.rb'
require 'date'

class WeatherController < ApplicationController
  Dev = 48
  PARAM = {lon: "coord__lon", lat: "coord_lat", sunrize: "sys_sunrize", sunset: "sys_sunset", description: "weather_description", temp: "main_temp", pressure: "main_oressure", humidity: "main_humidity", temp_min: "main_temp__min", temp_max: "main_temp_max", windspeed: "wind_speed", clouds: "clouds_all", get_time: "dt"}
  PARAM_TIME = {sunrize: "sys_sunrize", sunset: "sys_sunset", get_time: "dt"}

  def show
    @d = Pref.find(1)
=begin
    unless @wdata = Pref.find_by_pref_id params[:id].weather
      update_data
    elsif DateTime.now > @weather.time + Rational(1, Dev)
      update_data
    end
    @weather = @wdata
=end
  end

  def self.update_data
    w = Weather.new(:place => Pref.find_by_id_params[:id].pref_name_en)
    w.get
    PARAM.each do |k, v|
      @wdata.update_attribute(k, w.v)
    end
    PARAM_TIME.each do |k, v|
    	@wdata.update_attribute(k, Time.at(w.v.to_i))
    end
  end

  def get
  end
end
